<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>okbutwhat.com</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fff; color: #111; line-height: 1.5;
    }
    a { color: inherit; text-decoration: none; }
    ul { list-style: none; }

    /* ===== Header ===== */
    .header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
      background: #fff; border-bottom: 1px solid #e5e7eb;
      padding: 16px 20px; display: flex; align-items: center;
      transition: background .25s ease, border-color .25s ease, color .25s ease;
    }
    .header.scrolled { background: #111; border-color: #000; }
    .header.scrolled .site-title,
    .header.scrolled .menu-icon,
    .header.scrolled .desktop-nav a { color: #fff; }

    .menu-icon { font-size: 20px; padding: 6px; margin: -6px; cursor: pointer; color:#666; }
    .site-title { font-weight: 700; font-size: 20px; margin-left: 12px; letter-spacing: .5px; }
    .desktop-nav { display:none; margin-left:auto; }
    .desktop-nav > ul { display:flex; gap:28px; }
    .desktop-nav a { color:#666; font-weight:600; padding:8px 0; }
    .desktop-nav a:hover { color:#111; }
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.4); display:none; z-index: 900; }
    .overlay.active { display:block; }

    /* Sidebar */
    .sidebar {
      position: fixed; left:-220px; top:0; height:100vh; width:220px;
      background:#fafbfc; border-right:1px solid #e5e7eb; padding:64px 14px 16px;
      transition:left .25s ease; z-index: 950; overflow-y:auto;
    }
    .sidebar.active { left:0; }
    .sidebar h3 { font-size:12px; color:#6b7280; text-transform:uppercase; letter-spacing:.5px; margin:16px 0 8px 8px; }
    .sidebar a { display:block; padding:10px 12px; border-radius:6px; color:#374151; font-weight:600; }
    .sidebar a:hover { background:#eef2f7; }

    /* ===== Content ===== */
    .wrap { max-width: 1024px; margin: 0 auto; padding: 120px 16px 40px; }
    .masthead { text-align:center; border-bottom: 2px solid #111; padding-bottom: 14px; margin-bottom: 22px; }
    .masthead h1 { font-size: clamp(36px, 6.8vw, 84px); font-weight: 800; letter-spacing: 2px; }
    .headline { text-align:center; margin: 12px auto 18px; max-width: 900px; }
    .headline h2 { font-size: clamp(28px, 4.2vw, 56px); font-weight: 800; line-height: 1.05; }

    /* Lead image block (auto-populated via JS) */
    .lead-image {
      display:none; /* hidden until an image is found */
      margin: 18px auto 10px; width: 100%; max-width: 780px; aspect-ratio: 4/3;
      background: #e5e7eb; border: 1px solid #111;
      background-size: cover; background-position: center; filter: grayscale(100%);
    }

    /* ===== Drudge-style News List ===== */
    .news-embed { margin-top: 24px; }
    .news-embed h2 { text-align:center; margin:22px 0 12px; font-weight:800; }
    #newsList { max-width: 900px; margin: 0 auto; }
    .news-row { border-bottom: 1px dotted #111; padding: 12px 0; }
    .news-title { font-weight: 800; cursor: pointer; line-height: 1.3; text-decoration: underline; }
    .news-title:focus { outline: 2px dashed #111; outline-offset: 2px; }
    .news-details { display:none; margin-top: 8px; font-weight:600; color:#374151; }
    .source-btn {
      display:inline-block; margin-top: 8px; padding: 6px 10px;
      border: 1px solid #111; border-radius: 4px; font-weight: 700; text-decoration: none;
    }

    footer { text-align:center; color:#6b7280; font-size: 14px; margin-top: 26px; padding-top: 18px; border-top: 1px solid #e5e7eb; }
    footer a { text-decoration: underline; }

    @media (min-width: 1024px) {
      .desktop-nav { display:flex; }
      .menu-icon { display:none; }
      .wrap { padding: 140px 48px 48px; }
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>

  <header class="header" id="header">
    <div class="menu-icon" id="menuToggle">☰</div>
    <a class="site-title" href="/">okbutwhat</a>
    <nav class="desktop-nav">
      <ul>
        <!-- Cleaned: only News Agent + X -->
        <li><a href="https://somethingtoreport.com" target="_blank">News Agent</a></li>
        <li><a href="https://x.com/okbutwhat_" target="_blank">@okbutwhat_</a></li>
      </ul>
    </nav>
  </header>

  <nav class="sidebar" id="sidebar">
    <h3>Projects</h3>
    <a href="https://somethingtoreport.com" target="_blank">News Agent</a>
    <h3>Connect</h3>
    <a href="https://x.com/okbutwhat_" target="_blank">X: @okbutwhat_</a>
  </nav>

  <main class="wrap" id="mainContent">
    <div class="masthead"><h1>OKBUTWHAT.COM</h1></div>

    <div class="headline"><h2>PROTESTS ERUPT IN MANY CITIES</h2></div>

    <!-- Auto-image block (shows automatically if /assets/frontpage.* exists) -->
    <div class="lead-image" id="leadImage" role="img" aria-label="Lead image"></div>

    <!-- ===== Embedded News (Drudge-style) ===== -->
    <section class="news-embed" id="newsEmbed">
      <h2>LATEST FROM OKBUTWHAT NEWS</h2>
      <div id="newsList" aria-live="polite"></div>
    </section>

    <footer>
      Building in public — follow on X
      <a href="https://x.com/okbutwhat_" target="_blank">@okbutwhat_</a>
    </footer>
  </main>

  <script>
    // Sidebar + overlay controls
    const menuToggle = document.getElementById('menuToggle');
    const sidebar    = document.getElementById('sidebar');
    const overlay    = document.getElementById('overlay');
    const header     = document.getElementById('header');

    function openMenu() { sidebar.classList.add('active'); overlay.classList.add('active'); }
    function closeMenu() { sidebar.classList.remove('active'); overlay.classList.remove('active'); }

    menuToggle?.addEventListener('click', () => {
      sidebar.classList.contains('active') ? closeMenu() : openMenu();
    });
    overlay?.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sidebar.classList.contains('active')) closeMenu();
    });

    // Header darkens on scroll
    window.addEventListener('scroll', () => {
      if (window.scrollY > 20) header.classList.add('scrolled');
      else header.classList.remove('scrolled');
    });

    // ===== AUTO-IMAGE LOADER =====
    // Checks for /assets/frontpage.webp|jpg|png (in that order).
    // If found, sets it as the background-image and shows the block.
    (async function(){
      const el = document.getElementById('leadImage');
      if (!el) return;

      const candidates = [
        '/assets/frontpage.webp',
        '/assets/frontpage.jpg',
        '/assets/frontpage.png'
      ];

      async function exists(url){
        try {
          // Cache-busting query to avoid stale CDN; HEAD keeps it light.
          const r = await fetch(url + '?v=' + Date.now(), { method: 'HEAD', cache: 'no-store' });
          return r.ok;
        } catch { return false; }
      }

      for (const url of candidates) {
        if (await exists(url)) {
          el.style.backgroundImage = `url('${url}?v=${Date.now()}')`;
          el.style.display = 'block';
          break;
        }
      }
    })();

    // ===== Drudge-style News embed (no tokens; static fetch) =====
    (function(){
      const BASE = "https://spazedd.github.io/data";
      const listEl = document.getElementById('newsList');

      function ymd(d){ return d.toISOString().slice(0,10); }
      async function fetchJSON(u){
        try {
          const r = await fetch(u, { cache: 'no-store' });
          if (!r.ok) return null;
          return await r.json();
        } catch { return null; }
      }
      async function getLatestNews(maxDaysBack=10){
        for (let i=0;i<=maxDaysBack;i++){
          const d = new Date(); d.setDate(d.getDate()-i);
          const url = `${BASE}/news-${ymd(d)}.json`;
          const data = await fetchJSON(url);
          if (Array.isArray(data) && data.length) return {date: ymd(d), items: data};
        }
        return null;
      }
      function rowTemplate(item, idx){
        const title = item.title || "Untitled";
        const details = item.details || item.summary || "";
        const source = item.source || item.url || "";
        const id = `news-${idx}`;

        return `
          <div class="news-row">
            <button class="news-title" aria-expanded="false" aria-controls="${id}">
              ${title}
            </button>
            <div class="news-details" id="${id}">
              ${details ? `<div>${details}</div>` : ""}
              ${source ? `<a class="source-btn" href="${source}" target="_blank" rel="noopener">Source</a>` : ""}
            </div>
          </div>
        `;
      }
      function enhanceInteractivity(container){
        container.querySelectorAll('.news-title').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const targetId = btn.getAttribute('aria-controls');
            const panel = document.getElementById(targetId);
            const isOpen = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!isOpen));
            panel.style.display = isOpen ? 'none' : 'block';
          });
          btn.addEventListener('keydown', (e)=>{
            if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); btn.click(); }
          });
        });
      }
      function render(items, dateStr){
        if (!items || !items.length) {
          listEl.innerHTML = `<div style="text-align:center; color:#6b7280;">No news found.</div>`;
          return;
        }
        listEl.innerHTML = items.map(rowTemplate).join('');
        const h2 = listEl.parentElement.querySelector('h2');
        if (h2) h2.textContent = `LATEST FROM OKBUTWHAT NEWS — ${dateStr}`;
        enhanceInteractivity(listEl);
      }

      (async ()=>{
        const latest = await getLatestNews();
        if (!latest) {
          listEl.innerHTML = `<div style="text-align:center; color:#6b7280;">No news data found yet.</div>`;
          return;
        }
        render(latest.items, latest.date);
      })();
    })();
  </script>
</body>
</html>
